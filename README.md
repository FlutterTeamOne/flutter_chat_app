# chat_app

- На данный момент реализовывается основной каркас мессенджера: отправка сообщений одного пользователя другому через сервер с кешированием данных на персональном устройстве.
## Отчет по build 0.1.05:
- Реализованы следующие модули:

### GRPC:
- Унарный метод передачи сообщения клиент-сервер.

### Чат менеджер:
- Отображение страницы профиля.
- Отображение страницы чатов, выбор чатов, сообщения.
- Отображение загрузки сообщения на сервер.

### SendManager:
- Работает отправка сообщения, запись в локальную базу и серверную базу.

### SignalService:
- Реализованы сигналы на основе изменения БД, подключение к интернету.

### StorageManager:
- Реализована инициализация локальной БД. При ее отсутствии создается локальная БД с первоначальными таблицами. Реализованы CRUD-операции. Реализована прослушивание изменение в локальной БД


## How it works:
После клонирования перед запуском прописываем в консоль:
- Вы должны находится в директории приложения
- dart pub get или flutter pub get
- Переходим в директорию сервера
- cd \server
- dart pub get

Генеация прото файла для клиента:
- protoc -I .\proto\ .\proto\grpc_manager.proto --dart_out=grpc:./lib/src/generated/grpc_manager

Генерация прото файла для сервера
- protoc -I .\proto\ .\proto\grpc_manager.proto --dart_out=grpc:./server/lib/src/generated    

Запуск локального сервера:
- Вы должны находится в директории сервера cd \server
- dart .\server.dart 


В консоли проверьте на каком порту реализован сервер. Зайти в файл lib/client/grpc_client.dart Поменять порт на тот который вывел сервер.

Можем запускать приложение:
- Вы должны находится в директории flutter_chap_app
- flutter run 

При ошибках с grpc или Базой: 
Проверьте что база создана (Создается на каждом пк отдельно, тк файлики .dart_tool в .gitignore)

Для проверки успешной записи в базу раскомментировать нужные строки(создать базу) в файле:
\server\lib\src\test_db\test.dart

Запуск проверки:
dart .\server\lib\src\test_db\test.dart

### Запуск приложения с использованием сриптов 

#### PowerShell (Windows)

1. Открыть консоль PowerShell (pwsh)

2. В консоли из директории приложения запустить команду ./run_server_ps.ps1. Скрипт перейдет в папку ps1, и вызовет оттуда скрипты ger_nessessary_files.ps1 (запускает pub get как для основного приложения, так и для сервера; генерирует proto для grpc) и server.ps1 (запускает сервер в консоли).

3. Открыть новую консоль, не закрывая предыдущую.

4. Запустить скрипт для клиента (./run_client_ps.ps1). На данный момент содержит только команду flutter run.

#### Bash (Unix)

1. Открыть консоль bash.

2. Далее аналогично инструкции для PowerShell (пункты 2 - 4), заменяя ./run_server_ps.ps1 на ./run_server_bash.sh и ./run_client_ps.ps1 на ./run_client_bash.sh.Ы
